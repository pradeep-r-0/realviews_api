<div align="center">
  <h1>Fuel Top-ups</h1>
  <h2> <%= @car.car_make.name %> <%= @car.model %> <%= @car.variant %> - <%= @car.date_of_purchase.strftime("%B %Y") %></h2>

  <table class="table table-striped">
    <thead>
      <tr>
        <th>Date</th>
        <th>Bill Amount (â‚¹)</th>
        <th> Rate per Litre </th>
        <th>Brand</th>
        <th>Odometer Reading (km)</th>
        <th> Mileage (kmpl)</th>
        <th colspan="3"></th>
      </tr>
    </thead>

    <tbody>
      <% prev_topup = @fuel_topups.first %>
      <% @fuel_topups.each do |fuel_now| %>
        <tr>
          <td><%= fuel_now.topup_date.strftime("%d-%b-%Y") %></td>
          <td><%= fuel_now.price.to_i %></td>
          <td><%= fuel_now.rate_per_litre.to_f %></td>
          <td><%= fuel_now.brand %></td>
          <td><%= fuel_now.odometer_reading.to_i %></td>
          <% 
            if prev_topup.odometer_reading && prev_topup.id != fuel_now.id 
              mileage = calculate_mileage(prev_topup, fuel_now)
              mileage = (mileage > 30 || mileage < 0) ? '-' : mileage
          %>
            <td><%= mileage %></td>
          <% else %>
            <td> - </td>
          <% end %>
        </tr>
          <% ref_odo = fuel_now.odometer_reading %>
      <% prev_topup = fuel_now %>
      <% end %>
    </tbody>
  </table>

  <br>

  <%= link_to 'New Fuel Top-up', new_car_fuel_topup_path(@car), class: "btn btn-primary" %>
</div>
