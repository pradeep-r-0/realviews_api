

<%= form_with model: @dish, local: true, id: "dish-form", html: { autocomplete: "off" } do |form| %>
    <div align='center'>
        <h2 style="margin-top: 1px;">Add Review for a Dish</h2>
        <div id="flash-message" style="color: red; font-weight: bold; margin-bottom: 10px; display: none;"></div>
        <div class="form-group">
            <%= form.label :city_name, "City"%><br>
            <%= form.text_field :city_name, list: "city_names", required: true %>
            
            <datalist id="city_names">
            <% @city_names.each do |name| %>
                <option value="<%= name %>">
            <% end %>
            </datalist>
        </div>
        <div class="form-group">
            <%= form.label :restaurant_name, "Restaurant Name" %><br>
            <%= form.text_field :restaurant_name, list: "restaurant_names", required: true %>

            <datalist id="restaurant_names">
            <% @restaurant_names.each do |name| %>
                <option value="<%= name %>">
            <% end %>
            </datalist>
        </div>

        <div class="form-group">
            <%= form.label :name, "Dish Name" %><br>
            <%= form.text_field :name, required: true %>
        </div>

        <div class="form-group">
            <%= form.label :rating, "Rating (1 to 5)" %><br>
            <%= form.number_field :rating, in: 1..5, required: true %>
        </div>

        <div class="form-group">
            <%= form.label :comments %><br>
            <%= form.text_area :comments %>
        </div>

        <div class="form-group">
          <%= form.submit "Create Dish" %>
        </div>
        <div>
          <%= link_to "Back to List", dishes_path%>
        </div>
    </div>
<% end %>
<% if @pending_cities.size >0 %>
<div align='center'>
    <h2> Pending Cities for Approval </h2>
    <ul>
      <% @pending_cities.each do |city| %>
        <li><%= city.name %></li>
      <% end %>
    </ul>
</div>
<%end%>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const form = document.querySelector("#dish-form"); // pick correct form
    const cityInput = document.querySelector("#dish_city_name"); // Rails auto-id
    const flashDiv = document.querySelector("#flash-message");

    if (!form) return; // safety

    form.addEventListener("submit", (e) => {
      const validCities = Array.from(document.querySelectorAll("#city_names option"))
                              .map(opt => opt.value);

      if (!validCities.includes(cityInput.value)) {
        e.preventDefault(); // stop form submission
        flashDiv.textContent = "Please select a valid city from the dropdown.";
        flashDiv.style.display = "block";
        cityInput.focus();
      } else {
        flashDiv.style.display = "none"; // clear error if valid
      }
    });
  });
</script>
